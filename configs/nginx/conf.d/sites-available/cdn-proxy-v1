server{
     ### ğŸŒ CONFIGURACIÃ“N BÃSICA DEL SERVIDOR
    listen 80;                    # Puerto de escucha HTTP
    server_name _;                 # Acepta cualquier nombre de host o IP

    ### ğŸ“ CONFIGURACIÃ“N DEL PROXY PARA IMÃGENES
    location /imagenes/ {
         ### ğŸ”„ CONEXIÃ“N CON AZURE STORAGE
        proxy_pass https://stlistracecdnprodrc.blob.core.windows.net/imagenes/;
        proxy_set_header Host stlistracecdnprodrc.blob.core.windows.net;

        ### ğŸ’¾ CONFIGURACIÃ“N DE CACHÃ‰
        proxy_cache cdn_proxy;     # Activar sistema de cachÃ© definido en nginx.conf
        proxy_cache_valid 200 302 60m;  # Respuestas exitosas: 60 minutos
        proxy_cache_valid 404 1m;  # Errores 404: 1 minuto
        proxy_cache_revalidate on; # Verificar con el backend si el contenido cambiÃ³
        proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504; # Usar cachÃ© antigua si Azure falla
        proxy_cache_lock on;       # Evita mÃºltiples solicitudes concurrentes al backend,es decir, esto evita que varias solicitudes concurrentes para el mismo recurso vayan a Azure simultÃ¡neamente.
        

        ### â±ï¸ CONTROL DE EXPIRACIÃ“N DE CONTENIDO
        expires 1d;               # Tiempo de expiraciÃ³n en navegadores: 1 dÃ­a
        add_header Cache-Control "public, max-age=86400";
        add_header X-Cache-Status $upstream_cache_status; # Estado de la cachÃ© (HIT, MISS, BYPASS)
    }

     ### ğŸ”„ MANEJO DE RECURSOS ESTÃTICOS ESPECIALES
    location = /favicon.ico {
        log_not_found off;          # No registrar errores 404
        access_log off;             # No registrar accesos
        return 204;                 # Respuesta vacÃ­a exitosa
    }

    ### ğŸ›¡ï¸ FUTURAS MEJORAS EN SEGURIDAD (A IMPLEMENTAR POSTERIORMENTE)
    # ğŸ”¹ ConfiguraciÃ³n HTTPS con Let's Encrypt o Azure Front Door
    # ğŸ”¹ ProtecciÃ³n contra hotlinking
    # ğŸ”¹ RestricciÃ³n de IPs y acceso con GeoIP
    # ğŸ”¹ ImplementaciÃ³n de HTTP/2 y HSTS
}
